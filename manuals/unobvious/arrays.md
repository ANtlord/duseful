# Массивы и их неявное копирование

При работе с массивами иногда возникает необходимость сохранить
его в 2х разных переменных.

```d
int[] a = [1, 2, 3];
auto b = a;
```

В такой ситуации нужно быть крайне аккуратным с добавлением элементов
к массиву, так как может перевыделиться память.

```d
b ~= 4;
```

Оригинальный массив туда будет скопирован, к нему будет добавлен элемент.
В этой ситуации у нас получится 2 переменные, указывающие на 2 разные области.

```d
b[0] = 10;
assert (a[0] == 1);
```

Но в некоторых ситуациях этого может не происходить и при добавлении
элемента будет использована ранее резирвированная память и обе переменные
будут указывать на одну и ту же область памяти.

```d
b[0] = 10;
assert (a[0] == 10);
```

Поэтому лучше всегда использовать `dup`, если нужно получить копию памяти.
И лучше не добавлять к массиву элементы, если указатель на этот массив
сохранён в нескольких переменных.

```d
int[] a = [1,2,3];
auto b = a.dup; // теперь b точно будет копией a
b ~= 4;
```

или

```d
int[] a = [1,2,3];
auto b = a;
b ~= 4;
a = b; // явно обновляем переменную a, чтобы она указывала туда же что и b
```

[Пример на run.dlang.io](https://run.dlang.io/is/t88k7F)